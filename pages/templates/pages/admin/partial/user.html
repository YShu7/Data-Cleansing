{% load staticfiles %}
<link rel="stylesheet" href="{% static 'bootstrap-4.3.1/css/bootstrap.css' %}" type="text/css"/>
<link rel="stylesheet" href="{% static 'bootstrap-4.3.1/css/bootstrap.min.css' %}" type="text/css"/>
<script src="{% static 'bootstrap-4.3.1/js/bootstrap.bundle.js' %}" type="text/javascript"></script>

<form action="{% url 'add_user' %}" method="post">
    {% csrf_token %}
    <div id="card" class="card m-auto" style="width:80%">
        <div class="card-body form-row">
            <div class="form-group col-md-6">
                <label for="username">Name</label>
                <input class="form-control" type="text" name="username" id="username" value="{{obj.username}}">
            </div>

            <div class="form-group col-md-6">
                <label for="certificate">ID</label>
                <input class="form-control" type="text" name="certificate" id="certificate" value="{{obj.certificate}}">
            </div>

            <div class="form-group col-md-12">
                <label for="email">Email</label>
                <input class="form-control" type="email" name="email" id="email" value="{{obj.email}}">
            </div>

            <div class="form-group col-md-6">
                <label for="specialization">Sepcialization</label>
                <select class="form-control" id="specialization" name="specialization" value="{{obj.specialization}}">
                {% for spec in specializations %}
                    <option id="spec_{{spec.id}}" value="{{spec.id}}">{{spec.name}}</option>
                {% endfor %}
                </select>
            </div>

            <div class="form-group col-md-6">
                <label for="group">Group</label>
                <select class="form-control" name="group" id="group" value="{{obj.group}}">
                    <option value="" disabled selected>Please select an option</option>
                </select>
            </div>
        </div>
        <div class="card-footer">
            <input id="add_new_user" type="button" style="float:right" class="btn btn-outline-success" value="+ Add Another User">
        </div>
    </div>

    <br>
    <span class="d-flex justify-content-center">
        <button type="submit" class="btn btn-outline-primary" >
            Confirm
        </button>
    </span>
</form>
<script>
    $(document).ready(function(){
        $("#add_new_user").on("click", function(e) {

        });
        $("#specialization").on("change", function(e) {
            // Set selected option as variable
            var selectValue = $(this).val();
            $('#group').empty();
            groups_str = "{{groups}}";
            start = groups_str.indexOf(selectValue) + selectValue.length;
            groups_str = groups_str.substring(start);
            end = groups_str.indexOf(']');
            groups_str = groups_str.substring(0, end+1).replace(/&#39;/g, "");
            id_indices = getIndicesOf("id:", groups_str, true, true);
            name_indices = getIndicesOf("name:", groups_str, true, true);

            for (i = 0; i < id_indices.length; i++) {
                var substring = groups_str.substring(id_indices[i]);
                id_end = substring.indexOf(',');
                id = substring.substring(0, id_end);

                substring = groups_str.substring(name_indices[i]);
                name_end = substring.indexOf(',');
                name = substring.substring(0, name_end);
                $('#group').append("<option value='" + id + "' id='" + "group_" + id + "'>" + name + "</option>");
            }
        });
        function getIndicesOf(searchStr, str, caseSensitive, end) {
            var searchStrLen = searchStr.length;
            if (searchStrLen == 0) {
                return [];
            }
            var startIndex = 0, index, indices = [];
            if (!caseSensitive) {
                str = str.toLowerCase();
                searchStr = searchStr.toLowerCase();
            }
            while ((index = str.indexOf(searchStr, startIndex)) > -1) {
                if (end) {
                    indices.push(index + searchStrLen);
                } else {
                    indices.push(index);
                }
                startIndex = index + searchStrLen;
            }
            return indices;
        }
    });
</script>